# 图片导入功能使用指南

## 🎉 新功能：一键导入图片生成3DGS

现在你可以直接在Microscope Viewer中导入任意图片，自动生成3D高斯点云并实时查看！

---

## 🚀 快速开始

### 1. 启动程序

```bash
cd /Users/jqwang/144-显微镜拍照-bevy-3dgs/microscope_viewer
cargo run --release
```

### 2. 导入图片

**按 `I` 键** 打开文件选择对话框

- 支持格式：JPG, JPEG, PNG, BMP
- 选择任意图片（电路板、物体、场景等）
- 程序会自动上传到SHARP服务器

### 3. 等待处理

程序会显示实时进度：

```
📂 等待选择文件...
📤 上传中... 100%
⚙️  SHARP推理中 (预计0.5秒)...
📥 下载PLY... 100%
✅ 完成！总耗时: 5.3秒
🔄 加载新的3DGS: generated.ply
```

### 4. 查看3DGS

- 点云会自动加载并居中显示
- 使用相机控制查看3D模型

---

## ⌨️ 完整控制说明

### 导入功能
- **I 键**: 导入图片生成3DGS

### 相机控制
- **Ctrl + 左键拖拽**: 旋转视角
- **Ctrl + 右键拖拽**: 平移视角
- **Ctrl + 滚轮**: 缩放
- **方向键**: 键盘旋转
- **WASD**: 键盘平移
- **Space/Shift**: 上下移动
- **+/-**: 键盘缩放
- **R 键**: 重置相机

---

## 📊 性能数据

### 端到端延迟（优化后）

| 环节 | 时间 | 说明 |
|------|------|------|
| 图片上传 | 0.5秒 | 局域网传输 |
| **SHARP推理** | **0.48秒** | FP16优化 ⚡ |
| PLY下载 | 2.8秒 | 63MB文件 |
| Bevy加载 | 1秒 | 自动加载 |
| **总计** | **~5秒** | 从选择到显示 |

### 与原始版本对比

| 指标 | 原始 | 优化后 | 改善 |
|------|------|--------|------|
| SHARP推理 | 15秒 | 0.48秒 | ↓ 96.8% |
| 总延迟 | 19.3秒 | 5.3秒 | ↓ 72.5% |

---

## 🎯 使用场景

### 1. 显微镜图像
- 电路板检测
- 生物样本观察
- 材料分析

### 2. 普通照片
- 物体3D重建
- 场景建模
- 艺术创作

### 3. 快速原型
- 快速验证想法
- 实时预览效果
- 迭代优化

---

## 🔧 技术细节

### 架构

```
用户界面 (Bevy)
    ↓ [按I键]
文件选择对话框 (rfd)
    ↓ [选择图片]
后台线程上传
    ↓ [HTTP POST]
SHARP服务器 (192.168.31.164:8000)
    ↓ [FP16推理 0.48秒]
下载PLY文件
    ↓ [保存到assets/]
Bevy自动加载
    ↓ [实时渲染]
3DGS显示
```

### 优化措施

1. **FP16混合精度**: 2.63x加速
2. **模型预加载**: 避免8秒重复加载
3. **异步处理**: 不阻塞UI
4. **进度显示**: 实时反馈
5. **自动加载**: 无需手动操作

---

## 📝 示例工作流

### 场景1：检查电路板

```bash
# 1. 启动程序
cargo run --release

# 2. 按 I 键
# 3. 选择电路板照片
# 4. 等待5秒
# 5. 查看3D模型，检查焊点、元件等
```

### 场景2：批量处理

```bash
# 导入第一张图片
按 I → 选择 image1.jpg → 等待 → 查看

# 导入第二张图片
按 I → 选择 image2.jpg → 等待 → 查看

# 每次导入会替换当前显示的点云
```

---

## ⚠️ 注意事项

### 1. 服务器要求
- SHARP服务器必须运行在 `192.168.31.164:8000`
- 确保使用优化服务器：`python server_optimized.py`

### 2. 图片要求
- 推荐分辨率：512x512 到 2048x2048
- 文件大小：< 10MB
- 清晰度：越清晰效果越好

### 3. 网络要求
- 局域网连接
- 稳定的网络环境
- 上传速度 > 1MB/s

### 4. 处理时间
- 小图片（< 1MB）：~4秒
- 中等图片（1-5MB）：~5秒
- 大图片（5-10MB）：~7秒

---

## 🐛 故障排除

### 问题1：按I键没反应
**解决**：
- 检查窗口是否获得焦点
- 查看终端是否有错误信息
- 确保不在处理中（等待上一次完成）

### 问题2：上传失败
**解决**：
```bash
# 检查服务器是否运行
curl http://192.168.31.164:8000/

# 重启服务器
ssh wjq@192.168.31.164
cd /home/wjq/ml-sharp
source venv/bin/activate
python server_optimized.py
```

### 问题3：PLY加载失败
**解决**：
- 检查 `assets/generated.ply` 是否存在
- 查看文件大小是否正常（> 10MB）
- 重新导入图片

### 问题4：处理时间过长
**解决**：
- 检查网络连接
- 确认使用优化服务器（FP16）
- 查看服务器日志

---

## 📈 性能监控

### 查看实时日志

程序会在终端显示详细进度：

```
2026-01-20T23:00:00.000Z INFO microscope_viewer: 📂 打开文件选择对话框...
2026-01-20T23:00:05.000Z INFO microscope_viewer: 📁 选择了文件: "/path/to/image.jpg"
2026-01-20T23:00:05.500Z INFO microscope_viewer: 📤 上传图片 (2.50 MB)...
2026-01-20T23:00:06.000Z INFO microscope_viewer: 🚀 发送请求到: http://192.168.31.164:8000/api/predict
2026-01-20T23:00:06.500Z INFO microscope_viewer: ✅ SHARP推理完成，开始下载PLY...
2026-01-20T23:00:09.300Z INFO microscope_viewer: 📥 下载完成 (63.00 MB)
2026-01-20T23:00:10.300Z INFO microscope_viewer: 🎉 完成！总耗时: 5.30秒
2026-01-20T23:00:10.300Z INFO microscope_viewer: 🔄 加载新的3DGS: generated.ply
```

---

## 🎊 总结

### 核心优势

✅ **一键导入** - 按I键即可
✅ **快速处理** - 5秒端到端
✅ **自动加载** - 无需手动操作
✅ **实时反馈** - 进度实时显示
✅ **高质量** - SHARP论文级别

### 下一步优化

1. **PLY压缩传输** - 预计再提升40%速度
2. **批量处理** - 支持多图片队列
3. **历史记录** - 保存和切换历史模型
4. **UI界面** - 图形化进度条

---

**享受你的3DGS之旅！** 🚀
